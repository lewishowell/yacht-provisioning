generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(cuid())
  email            String   @unique
  name             String
  googleId         String   @unique
  avatarUrl        String?
  hasSeenOnboarding Boolean @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  inventoryItems    InventoryItem[]
  provisioningLists ProvisioningList[]
  meals             Meal[]
  mealPlans         MealPlan[]
}

model InventoryItem {
  id               String    @id @default(cuid())
  userId           String
  name             String
  category         String
  quantity         Float     @default(0)
  targetQuantity   Float     @default(0)
  unit             String
  expiryDate       DateTime?
  reorderThreshold Float     @default(0)
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, category])
  @@index([userId, name])
}

model ProvisioningList {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  status      String   @default("DRAFT")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  items ProvisioningListItem[]

  @@index([userId])
}

model ProvisioningListItem {
  id          String    @id @default(cuid())
  listId      String
  name        String
  category    String
  quantity    Float     @default(1)
  unit        String
  itemType    String    @default("trip")
  purchased   Boolean   @default(false)
  purchasedAt DateTime?
  createdAt   DateTime  @default(now())

  list ProvisioningList @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model Meal {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  servings    Int      @default(2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  ingredients MealIngredient[]
  plannedMeals PlannedMeal[]

  @@index([userId])
}

model MealIngredient {
  id       String @id @default(cuid())
  mealId   String
  name     String
  category String
  quantity Float  @default(1)
  unit     String

  meal Meal @relation(fields: [mealId], references: [id], onDelete: Cascade)

  @@index([mealId])
}

model MealPlan {
  id          String   @id @default(cuid())
  userId      String
  name        String
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  plannedMeals PlannedMeal[]

  @@index([userId])
}

model PlannedMeal {
  id         String   @id @default(cuid())
  mealPlanId String
  mealId     String
  date       DateTime
  slot       String

  mealPlan MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  meal     Meal     @relation(fields: [mealId], references: [id], onDelete: Cascade)

  @@index([mealPlanId])
  @@index([mealId])
}
